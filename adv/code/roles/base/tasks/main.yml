---
- name: Empty /etc/hosts
  shell: echo > /etc/hosts

- name: Generate /etc/hosts
  lineinfile: dest=/etc/hosts regexp='.*{{ item}}$'
              line="{{ hostvars[item]['ansible_eth1']['ipv4']['address'] }} {{ itemÂ }}"
              state=present
  when: hostvars[item]['ansible_eth1']['ipv4']['address'] is defined
  with_items: groups['all']
